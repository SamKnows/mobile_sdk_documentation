# Tests

## Measurement server
The measurement clients in the SamKnows SDK carry out their measurements against dedicated measurement servers provided by SamKnows. Some examples of these are included in the sample app. When using the SDK, you will need to configure a list of measurement servers for it to use.

A list of dedicated measurement servers appropriate for your geography and use-case can be obtained from SamKnows. Alternatively, you may wish to host your own measurement servers. In this instance, SamKnows can provide a software package suitable for installation on RHEL/CentOS 6.x or 7.x servers. For more information about measurement servers please contact your SamKnows account manager.

To find the best server for use, consider using the TestHostLocator. Documentation can be found in ./docs/SKDarwin/Classes/TestHostLocator.html. Providing a URL with a formatted file at the endpoint will determine which element from the list is the most suitable host at the time.

## Available tests
The measurements included in the SamKnows Android SDK are Download/Upload throughput, Latency, Jitter, Packet Loss, YouTube Video Streaming and Web Page Loading Times.

### Download and upload speed
These tests measure the download or upload HTTP throughput in bits per second, they are located in the HttpModule. There are static initialisers provided to get instances of the DownloadTestRunner or the UploadTestRunner and returns a HttpResult object.

### Latency, Jitter and Packet Loss
This is a single test that provides three separate metrics upon completion: latency, jitter and packet loss. The test is contained in the PerformanceModule which provides a static initialiser to get an instance of thePerformanceTestRunner and returns a LatencyResult object.

### YouTube
The YouTube test measures the streaming performance of the user's internet connection with a developer-definable YouTube video URL. This test is contained within the YouTubeModule which provides a static initialiser to get an instance of the YouTubeTestRunner and returns a YouTubeResult object.

### WebGet
The webget test measures the performance of the user's internet connection of loading developer definable web page. This test is contained within the WebGetModule which provides a static initialiser to get an instance of the WebGetRunner and returns a BrowsingResult object.

## Data collection
> The following is an example of the JSON submitted when a test sequence is complete. This sample includes just the data from a latency/jitter test. Note that the data outside of tests is included once per submission, but the tests/<test name>/environment object is captured and included within each test object for that sequence.

```json
{
    "version": 1,
    "agentId": "<id assigned by sk1>",
    "data": {
        "device_environment": {
            "carrier_name": "EE",
            "id": "<auto-generated device id>",
            "mobile_network_code": "30",
            "iso_country_code": "gb",
            "operating_system_version": "iOS 11.2.2",
            "mobile_country_code": "234",
            "model": "iPhone10,6",
            "manufacturer": "Apple"
        },
        "metadata": {
            "app_version": "v7 b2"
        },
        "tests": {
            "latency": {
                "round_trip_time": 99817,
                "mean_opinion_score": 1,
                "stream_bits_per_sec": 51200,
                "utc_datetime": "2018-01-22T13:43:52Z",
                "target": "n1-palermo-it.samknows.com",
                "failures": 0,
                "local_datetime": "2018-01-22T13:43:52Z",
                "environment": {
                    "other": {
                        "is_logged_in": false
                    },
                    "location": {
                        "lon": 0,
                        "lat": 51,
                        "accuracy": {
                            "horizontal": 65,
                            "vertical": 10
                        },
                        "address": "135 Park Street, SE1 9EA"
                    },
                    "telephony": {
                        "cellular_technology": "4g",
                        "connection_type": "cell"
                    },
                    "memory": {
                        "device_free": 1796,
                        "app_used": 95,
                        "device_used": 0
                    }
                },
                "status_code": 0,
                "packet_size": 160,
                "successes": 1,
                "packets_received": 200,
                "duration": 5005490,
                "packets_sent": 200,
                "jitter": 28491
            }
        }
    }
}
```

The SamKnows iOS SDK reports its measurements to one or more data collection endpoints. Data is transmitted to the collection endpoint in JSON format over an HTTPS connection. The data collected is limited to the measurement results themselves, environmental information (e.g. Wi-Fi and cellular connectivity status) and a persistent unique identifier for the handset. No personal information is collected. By default, the SDK is configured to transmit measurement results to the SamKnows data collection endpoint exclusively.

The following environmental information is collected:

* agentID - From the server, after being linked to a panel.
* deviceID - Generated on the device and saved to the keychain.
* locationData - This is added if the user has granted the application location access. This needs to be requested in the application itself, the SDK does not request permissions. Note that this contains horizontalAccuracy, verticalAccuracy, latitude, longitude, and locationAddress.name and locationAddress.postalCode if the last known placemark was able to be found.
* manufacturer - This is always set to "Apple" for iOS.
* deviceModel - Contains the model code.
* osName - System name.
* osVersion - Version of the system.
* osDisplayFull - String in the format: "System name system version"
* memoryUsed - Assigned memory is how much is currently reserved for the app's sandbox. May not explicitly reflect the current physical footprint.
* memoryFree - Available memory is the amount of memory not currently in use by this app, the system, or other apps.
* indoorState - Whether the user is indoors, outdoors, or unknown.

The following connection information is collected:

* connectionType - wi-fi or cell.
* cellularTechnology - 2G/3G/4G
* carrierName - String containing the name of the subscriber's cellular service provider.
* carrierNetworkCode - String containing the mobile network code for the subscriber's cellular service provider, in its numeric representation
* carrierCountryCode - String containing the mobile country code for the subscriber's cellular service provider, in its numeric representation
* ssid - Wi-Fi network name.

Additional data collected:

* appVersion - The version of the application the user is running.

All of this data is stored against the panelKey you provide, as well as being submitted to SamKnows One.
